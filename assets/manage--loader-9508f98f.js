import{d as l}from"./db-61ab6f32.js";import{l as g}from"./db_calls-9f004f7d.js";import{i as v}from"./pocketbase-8cd5b0bf.js";import{j as y}from"./index-1ad1b3d7.js";const w=25,k=async({request:t,params:e})=>{var i,c;const a=new URL(t.url),n=Math.max(m("offset",a.searchParams)||0,0),u=Math.max(m("limit",a.searchParams)||w,10),[f,h]=await Promise.all([l.list.orderBy("createdAt").reverse().offset(n).limit(u).toArray(),l.list.count()]),s=[];for(const o of f){const r=await g(o.surveyId,P(o.surveyType));if(r){const _=(i=r==null?void 0:r.data)==null?void 0:i.ho_va_ten,d=(c=r==null?void 0:r.data)==null?void 0:c.nguoi_kham;let p={...o,extra:{ho_va_ten:_,nguoi_kham:d}};s.push(p)}else s.push({...o,extra:{}})}return y({list:s,count:h,offset:n,limit:u,auth:v()})};function x(t,e){return e.get(t)}function m(t,e){const a=x(t,e);return a&&parseInt(a)||null}function P(t){switch(t){case"mau_giao":return"mau_giao_form";case"tieu_hoc":return"tieu_hoc_form";case"nguoi_lon":return"nguoi_lon_form";case"who_children_surface":return"who_children_surface_form"}}export{w as defaultLimit,k as loader};
